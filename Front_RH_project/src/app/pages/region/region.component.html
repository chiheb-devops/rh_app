<div class="container mt-4">
  
  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Region Management</h2>
    <button class="btn btn-primary btn-add" (click)="openModal()">
      + Add New
    </button>
  </div>

  <!-- TABLE SECTION -->
  <div class="table-container">
    <table class="table">
    <thead>
  <tr>
    <th class="sortable" (click)="sortData('id')">
      ID <span>{{ getSortIcon('id') }}</span>
    </th>
    <th class="sortable" (click)="sortData('name')">
      Region Name <span>{{ getSortIcon('name') }}</span>
    </th>
    <th class="text-center">Actions</th>
  </tr>
</thead>
      <tbody>
        <tr *ngFor="let r of regions">
          <td>#{{ r.id }}</td>
          <td>{{ r.name }}</td>
          
          <td class="text-center action-buttons">
          
            <button class="btn-icon view" (click)="openViewModal(r)" title="View Details">
              
            </button>
            
            <button class="btn-icon edit" (click)="editRegion(r)" title="Edit">
              
            </button>
            
          
            <button class="btn-icon delete" (click)="openDeleteModal(r)" title="Delete">
              
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 1. ADD/EDIT FORM MODAL     -->
 
  <div class="modal-overlay" *ngIf="isModalOpen">
    <div class="modal-content">
      <div class="modal-header">
        <h3>{{ form.id ? 'Update Region' : 'Add Region' }}</h3>
        <span class="close-btn" (click)="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <form>
          <div class="row">
            <div class="col-md-12 mb-3">
              <label>Region Name</label>
              <input type="text" class="form-control" [(ngModel)]="form.name" name="name" placeholder="e.g. North America">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
            <button type="button" class="btn btn-primary" (click)="saveRegion()">
              {{ form.id ? 'Save Changes' : 'Create' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>


  <!-- 2. VIEW DETAILS MODAL      -->
  
  <div class="modal-overlay" *ngIf="isViewModalOpen">
    <div class="modal-content view-card">
      <div class="modal-header">
        <h3>Region Details</h3>
        <span class="close-btn" (click)="closeViewModal()">&times;</span>
      </div>
      
      <div class="modal-body text-center" *ngIf="selectedRegion">
        
  
        <div class="profile-avatar">
          
        </div>

        <h4 class="emp-name">
          {{ selectedRegion.name }}
        </h4>
        <p class="emp-id">Region ID: #{{ selectedRegion.id }}</p>

        <hr class="divider">

        <div class="details-grid">
          <div class="detail-item highlight">
            <span class="label"> Status</span>
            <span class="value salary-text">Active</span>
          </div>
           <div class="detail-item clickable-item" (click)="toggleDeptList()" 
       [class.has-items]="selectedRegion.dept_count > 0">
    <span class="label">üè¢ Departments</span>
    <span class="value">
      
      <span class="small-hint" *ngIf="selectedRegion.dept_count > 0">
        (Click to {{ showDeptList ? 'hide' : 'view' }})
      </span>
    </span>
  </div>
        </div>
<div class="dept-list-container" *ngIf="showDeptList">
    <h5 class="list-title">Department List:</h5>
    <ul class="dept-list">
      <li *ngFor="let name of selectedRegion.dept_names">
        {{ name }}
      </li>
    </ul>
  </div>
      </div>
      <div class="modal-footer justify-content-center">
        <button class="btn btn-primary" (click)="closeViewModal()">Close</button>
      </div>
    </div>
  </div>
<!-- ========================== -->
<!-- DELETE CONFIRMATION MODAL  -->
<!-- ========================== -->
<div class="modal-overlay delete-layer" *ngIf="isDeleteModalOpen">
  <div class="modal-content delete-card">
    
    <!-- Warning Icon -->
    <div class="delete-icon-wrapper">
      <span class="delete-icon">‚ö†Ô∏è</span>
    </div>

    <!-- Text Content -->
    <div class="delete-body">
      <h3>{{ deleteMessage }}</h3>
      <p>{{ deleteSubMessage }}</p>
    </div>

    <!-- Actions -->
    <div class="delete-actions">
      <button class="btn-cancel" (click)="closeDeleteModal()">Annuler</button>
      <button class="btn-confirm-delete" (click)="confirmDelete()">Oui, Supprimer</button>
    </div>

  </div>
</div>
<!-- TOAST NOTIFICATION CONTAINER -->
<div class="toast-container" [class.show]="showToast" [class.error]="toastType === 'error'">
  <div class="toast-icon">
    {{ toastType === 'success' ? '‚úÖ' : '‚ùå' }}
  </div>
  <div class="toast-body">
    <h4 class="toast-title">{{ toastType === 'success' ? 'Success' : 'Error' }}</h4>
    <p class="toast-message">{{ toastMessage }}</p>
  </div>
  <button class="toast-close" (click)="showToast = false">‚úï</button>
</div>
</div>
